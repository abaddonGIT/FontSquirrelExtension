var FontConverterStrategy=function(){};FontConverterStrategy.prototype={run:function(){this.target=d.querySelector("input[type=file]"),this.preloder=d.querySelector("#preloder"),this.finalBlock=d.querySelector("#finalBlock"),this.agreement=this.finalBlock.querySelector("#agreement"),this.generate=d.querySelector("form#generate"),this.download=this.generate.querySelector("button"),this.init()},addEvents:function(){this.download.addEventListener("click",this.convertFont,!1),this.finalBlock.style.display="block"},removeEvents:function(){this.download.removeEventListener("click",this.convertFont,!1),this.finalBlock.style.display="none"},createXHR:function(a,b,c){return new Promise(function(d,e){var f=new XMLHttpRequest,g=new FormData;a.forEach(function(a){g.append(a.name,a.value)}),c&&(f.responseType="blob"),f.onload=function(){4===this.readyState&&200===this.status&&d(this.response)},f.onabort=function(){e(Error("Network Abort"))},f.onerror=function(){e(Error("Network Error"))},f.open("POST",b,!0),f.send(g)})},collectionValue:function(a){for(var b=a.querySelectorAll("input"),c=b.length,d=[];c--;){var e=b[c];if(e.files){if(!this.checkMimeType(e.files[0]))return!1;d.push({name:e.getAttribute("name"),value:e.files[0]}),d.push({name:"Filename",value:e.value.replace("C:\\fakepath\\","")})}else d.push({name:e.getAttribute("name"),value:e.value})}return d},loderState:function(a){this.preloder.style.display=a?"block":"none"},showNotification:function(a,b){var c={type:"basic",title:"",message:a,iconUrl:"../img/icon_128.png"};ch.notifications.getAll(function(a){a[b]?ch.notifications.clear(b,function(){ch.notifications.create(b,c,function(){})}):ch.notifications.create(b,c,function(){})})},checkMimeType:function(a){if(a){var b=a.name.split(".");return"ttf"===b[1].toLowerCase()||"otf"===b[1].toLowerCase()?!0:!1}return!1},clearForm:function(){this.target.value="",this.agreement.checked=!1}};var FontEverythingfontsStrategy=function(){"use strict";var a=this;this.init=function(){this.urls={generate:"http://everythingfonts.com/font-face"},this.addEvents()},this.convertFont=function(b){var c=a.target.files.length?a.target.files[0]:null,d=a.agreement.checked?"yes":!1;if(b.preventDefault(),a.checkMimeType(c))if(d){var e=[{name:"ttffile",value:c},{name:"permission",value:d}];a.loderState(!0),a.createXHR(e,a.urls.generate,!0).then(function(b){"text/html"===b.type?a.showNotification("Данный шрифт не подлежит конвертации!","error"):ch.downloads.download({url:w.URL.createObjectURL(b),filename:c.name+".zip"}),a.clearForm(),a.loderState(!1)},function(){a.showNotification("Ошибка во время исполнения запроса","error"),a.loderState(!1)})}else a.showNotification("Вы не согласились с условием использования!","agreement");else a.showNotification("Вы не загрузили исходный шрифт, или загрузили неправильный формат!","agreement")}};FontEverythingfontsStrategy.prototype=Object.create(FontConverterStrategy.prototype);var FontFont2webStrategy=function(){"use strict";var a=this;this.urls={generate:"http://www.font2web.com/convert.php"},this.init=function(){this.addEvents()},this.convertFont=function(b){var c=a.target.files.length?a.target.files[0]:null,d=a.agreement.checked?"yes":!1;if(b.preventDefault(),a.checkMimeType(c))if(d){var e=[{name:"MAX_FILE_SIZE",value:999999},{name:"permission",value:d},{name:"userfile",value:c},{name:"x",value:125},{name:"y",value:41}];a.loderState(!0),a.createXHR(e,a.urls.generate,!0).then(function(b){"text/html"===b.type?a.showNotification("Данный шрифт не подлежит конвертации!","error"):ch.downloads.download({url:w.URL.createObjectURL(b),filename:c.name+".zip"}),a.clearForm(),a.loderState(!1)},function(){a.showNotification("Ошибка во время исполнения запроса","error"),a.loderState(!1)})}else a.showNotification("Вы не согласились с условием использования!","agreement");else a.showNotification("Вы не загрузили исходный шрифт, или загрузили неправильный формат!","agreement")}};FontFont2webStrategy.prototype=Object.create(FontConverterStrategy.prototype);var d=document,ch=chrome,w=window,FontSquirrelStrategy=function(){"use strict";var a=this;this.urls={uplode:"http://www.fontsquirrel.com/uploadify/fontfacegen_uploadify.php",insert:"http://www.fontsquirrel.com/tools/insert",generate:"http://www.fontsquirrel.com/tools/generate",progress:"http://www.fontsquirrel.com/tools/progress/",download:"http://www.fontsquirrel.com/tools/download"},this.init=function(){this.addEvents()},this.addEvents=function(){this.target.addEventListener("change",this.fileSelect,!1),this.download.addEventListener("click",this.convertFont,!1)},this.removeEvents=function(){this.target.removeEventListener("change",this.fileSelect,!1),this.download.removeEventListener("click",this.convertFont,!1)},this.finalStep=function(a){this.finalBlock.style.display="block",this.uplodeOpt=a},this.getConvertOptions=function(){for(var a=this.generate.querySelectorAll("input"),b=a.length,c=[];b--;){var d,e=a[b],f=e.getAttribute("type"),g=e.getAttribute("name");if("checkbox"===f){if(d=e.checked,!d)return this.showNotification("Вы не согласились с условием использования!","agreement"),this.loderState(!1),!1;d="Y"}else d=e.value;if("id"===g||"dirname[]"===g){if(!this.uplodeOpt)return this.showNotification("Вы не загрузили исходный шрифт!","agreement"),this.loderState(!1),!1;d=this.uplodeOpt.id}c.push({name:g,value:d})}return c},this.getProgress=function(b){var c=null;w.setTimeout(function(){c=new XMLHttpRequest,c.onload=function(){if(4===this.readyState&&200===this.status){var d=JSON.parse(this.response);1*d.progress!==100?a.getProgress(b):(c=null,b())}},c.open("POST",this.urls.progress+this.uplodeOpt.id,!0),c.send()}.bind(this),4e3)},this.convertFont=function(b){a.loderState(!0);var c=a.getConvertOptions();c&&a.createXHR(c,a.urls.generate).then(function(){a.getProgress(function(){a.createXHR(c,a.urls.download,!0).then(function(b){a.loderState(!1),a.clearForm(),a.uplodeOpt=null,ch.downloads.download({url:w.URL.createObjectURL(b),filename:"webfont.zip"})})})},function(b){a.showNotification(b,"error")}),b.preventDefault()},this.fileSelect=function(){var b=d.querySelector("form#uplode"),c=a.collectionValue(b);c?(a.loderState(!0),a.createXHR(c,a.urls.uplode).then(function(a){return[{name:"original_filename",value:c[0].value},{name:"path_data",value:a}]},function(b){a.showNotification(b,"error"),a.loderState(!1)}).then(function(b){return a.createXHR(b,a.urls.insert)},function(b){a.showNotification(b,"error"),a.loderState(!1)}).then(function(b){var c=JSON.parse(b);c.message?a.showNotification(c.message,"error"):a.finalStep(c),a.loderState(!1)})):a.showNotification("Данный шрифт не подлежит конвертации!","error")}};FontSquirrelStrategy.prototype=Object.create(FontConverterStrategy.prototype),function(a,b,c,e){"use strict";var f=function(a){this.strategy=a,this.run=function(){return this.strategy.run()}};w.onload=function(){var a=d.querySelector("#convertor-select"),g=new f(new b),h=null,i=null;g.run(),a.addEventListener("change",function(){var a=this.value;switch(a){case"fontsquirrel":g.strategy.clearForm(),g.strategy.addEvents(),h&&h.strategy.removeEvents(),i&&i.strategy.removeEvents();break;case"everythingfonts":g.strategy.clearForm(),g.strategy.removeEvents(),i&&i.strategy.removeEvents(),h?h.strategy.addEvents():(h=new f(new c),h.run());break;case"font2web":g.strategy.clearForm(),g.strategy.removeEvents(),h&&h.strategy.removeEvents(),i?i.strategy.addEvents():(i=new f(new e),i.run())}},!1)}}(FontConverterStrategy,FontSquirrelStrategy,FontEverythingfontsStrategy,FontFont2webStrategy);
//# sourceMappingURL=sourcemap.map